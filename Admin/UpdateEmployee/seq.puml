@startuml
actor Admin

participant "EmployeeController" as Controller
participant "Model Binder / Validator" as Validator
participant "Mapper" as Mapper
participant "EmployeeService" as Service
participant "IEmployeeRepository" as RepoInterface
participant "EmployeeRepository" as Repo
participant "DbContext (EF Core)" as Db
database "Database" as DB

Admin -> Controller : PUT /employees/{id} { EmployeeEditVM }
activate Controller

Controller -> Validator : Validate ModelState
activate Validator
Validator --> Controller : valid / invalid
deactivate Validator

alt Model invalid
    Controller --> Admin : 400 Bad Request
    deactivate Controller
else
    Controller -> Service : GetByIdOrThrowAsync(vm.EmployeeId)
    activate Service

    Service -> RepoInterface : GetByIdAsync(vm.EmployeeId)
    activate RepoInterface
    RepoInterface -> Repo : GetByIdAsync(vm.EmployeeId)
    activate Repo
    Repo -> Db : SELECT WHERE EmployeeId = vm.EmployeeId
    activate Db
    Db -> DB : execute SELECT
    DB --> Db : row / null
    deactivate DB
    Db --> Repo : entity / null
    deactivate Db
    Repo --> RepoInterface : return entity
    deactivate Repo
    RepoInterface --> Service : return entity
    deactivate RepoInterface

    alt entity not found
        Service --> Controller : NotFound / throw
        Controller --> Admin : 404 Not Found
        deactivate Service
        deactivate Controller
    else
        Service --> Controller : existing Employee
        deactivate Service

        Controller -> Mapper : map vm -> existing Employee
        activate Mapper
        Mapper --> Controller : updated Employee
        deactivate Mapper

        Controller -> Service : UpdateAsync(updated Employee)
        activate Service

        Service -> RepoInterface : Update(Employee)
        activate RepoInterface
        RepoInterface -> Repo : Update(Employee)
        activate Repo
        Repo -> Db : Attach/mark modified
        activate Db
        Db --> Repo : tracked/modified
        deactivate Db
        Repo --> RepoInterface : return
        deactivate Repo
        RepoInterface --> Service : return
        deactivate RepoInterface

        Service -> RepoInterface : SaveAsync()
        activate RepoInterface
        RepoInterface -> Repo : SaveAsync()
        activate Repo
        Repo -> Db : SaveChangesAsync() -> UPDATE
        activate Db
        Db -> DB : execute UPDATE
        DB --> Db : result
        deactivate DB
        Db --> Repo : save result
        deactivate Db
        Repo --> RepoInterface : return
        deactivate Repo
        RepoInterface --> Service : return
        deactivate RepoInterface

        Service --> Controller : success
        deactivate Service

        Controller --> Admin : 200 OK / 204 No Content
        deactivate Controller
    end
end
@enduml
```@startuml
actor Admin

participant "EmployeeController" as Controller
participant "Model Binder / Validator" as Validator
participant "Mapper" as Mapper
participant "EmployeeService" as Service
participant "IEmployeeRepository" as RepoInterface
participant "EmployeeRepository" as Repo
participant "DbContext (EF Core)" as Db
database "Database" as DB

Admin -> Controller : PUT /employees/{id} { EmployeeEditVM }
activate Controller

Controller -> Validator : Validate ModelState
activate Validator
Validator --> Controller : valid / invalid
deactivate Validator

alt Model invalid
    Controller --> Admin : 400 Bad Request
    deactivate Controller
else
    Controller -> Service : GetByIdOrThrowAsync(vm.EmployeeId)
    activate Service

    Service -> RepoInterface : GetByIdAsync(vm.EmployeeId)
    activate RepoInterface
    RepoInterface -> Repo : GetByIdAsync(vm.EmployeeId)
    activate Repo
    Repo -> Db : SELECT WHERE EmployeeId = vm.EmployeeId
    activate Db
    Db -> DB : execute SELECT
    DB --> Db : row / null
    deactivate DB
    Db --> Repo : entity / null
    deactivate Db
    Repo --> RepoInterface : return entity
    deactivate Repo
    RepoInterface --> Service : return entity
    deactivate RepoInterface

    alt entity not found
        Service --> Controller : NotFound / throw
        Controller --> Admin : 404 Not Found
        deactivate Service
        deactivate Controller
    else
        Service --> Controller : existing Employee
        deactivate Service

        Controller -> Mapper : map vm -> existing Employee
        activate Mapper
        Mapper --> Controller : updated Employee
        deactivate Mapper

        Controller -> Service : UpdateAsync(updated Employee)
        activate Service

        Service -> RepoInterface : Update(Employee)
        activate RepoInterface
        RepoInterface -> Repo : Update(Employee)
        activate Repo
        Repo -> Db : Attach/mark modified
        activate Db
        Db --> Repo : tracked/modified
        deactivate Db
        Repo --> RepoInterface : return
        deactivate Repo
        RepoInterface --> Service : return
        deactivate RepoInterface

        Service -> RepoInterface : SaveAsync()
        activate RepoInterface
        RepoInterface -> Repo : SaveAsync()
        activate Repo
        Repo -> Db : SaveChangesAsync() -> UPDATE
        activate Db
        Db -> DB : execute UPDATE
        DB --> Db : result
        deactivate DB
        Db --> Repo : save result
        deactivate Db
        Repo --> RepoInterface : return
        deactivate Repo
        RepoInterface --> Service : return
        deactivate RepoInterface

        Service --> Controller : success
        deactivate Service

        Controller --> Admin : 200 OK / 204 No Content
        deactivate Controller
    end
end
@enduml