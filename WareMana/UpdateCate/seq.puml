@startuml

actor "Warehouse Manager" as WM
boundary "UI (Web/App)" as UI
participant "CategoryController" as Ctrl
participant "CategoryService" as CatSvc
participant "Service<Category> (base)" as BaseSvc
participant "Repository<Category>" as Repo
database "DB (NutriBarnContext)" as DB

WM -> UI : 1. Nhấn nút "Chỉnh sửa" trên một category
UI -> Ctrl : 2.1 GET /api/categories/GetById/{id} (Lấy dữ liệu để hiển thị)
Ctrl --> UI : 2.2 Trả về dữ liệu category
UI --> WM : 2.3 Hiển thị form chỉnh sửa với thông tin đã có

WM -> UI : 3.1 Thay đổi thông tin và nhấn "Lưu"
UI -> Ctrl : 3.2 PUT /api/categories/UpdateCategory/{Id}\n(Body chứa: CategoryUpdateVM)

Ctrl -> CatSvc : 4.1 GetById(Id) (Kiểm tra sự tồn tại)
CatSvc -> DB : 4.2 Query Category by Id
DB --> CatSvc : 4.3 Trả về CategoryDto?

alt Category không tồn tại
    CatSvc --> Ctrl : 4.4b Trả về null
    Ctrl --> UI : 4.5b 400 BadRequest: Không tồn tại danh mục
    UI --> WM : 6b Hiển thị lỗi
else Category tồn tại
    Ctrl -> Ctrl : 5.1 Cập nhật các thuộc tính của category từ model
    Ctrl -> CatSvc : 5.2 UpdateAsync(category)
    CatSvc -> BaseSvc : 5.3 UpdateAsync(category)
    BaseSvc -> Repo : 5.4 Update(category) (Đánh dấu entity là Modified)
    BaseSvc -> Repo : 5.5 SaveAsync()
    Repo -> DB : 5.6 Execute UPDATE command & SaveChanges
    DB --> Repo : 5.7 OK
    Repo --> BaseSvc : 5.8 OK
    BaseSvc --> CatSvc : 5.9 OK
    CatSvc --> Ctrl : 5.10 OK
    Ctrl --> UI : 5.11 200 OK (ApiResponse chứa CategoryDto đã cập nhật)
    UI --> WM : 6 Hiển thị thông báo cập nhật thành công
end

@enduml